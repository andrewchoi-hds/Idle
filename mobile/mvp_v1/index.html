<!doctype html>
<html lang="ko">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
    <meta name="theme-color" content="#0a1110" />
    <title>Idle Xianxia Mobile MVP v1</title>
    <link rel="stylesheet" href="./app.css" />
  </head>
  <body>
    <main class="app">
      <header class="panel header">
        <div>
          <p class="eyebrow">Mobile Vertical Slice v1</p>
          <h1>선협 방치형 MVP</h1>
        </div>
        <p id="appStatus" class="status" aria-live="polite">로딩 중...</p>
      </header>

      <section class="panel stage">
        <div class="stage-head">
          <h2 id="stageDisplay">-</h2>
          <span id="worldTag" class="world-tag">-</span>
        </div>
        <p class="sub">
          난이도 <strong id="difficultyIndex">-</strong> · 다음 돌파 필요 기
          <strong id="qiRequired">-</strong>
        </p>
        <div class="progress-wrap">
          <div id="qiProgressBar" class="progress-bar"></div>
        </div>
      </section>

      <section class="panel stats">
        <article>
          <h3>기(氣)</h3>
          <p id="statQi">0</p>
        </article>
        <article>
          <h3>영석</h3>
          <p id="statSpiritCoin">0</p>
        </article>
        <article>
          <h3>환생정수</h3>
          <p id="statRebirthEssence">0</p>
        </article>
        <article>
          <h3>환생 횟수</h3>
          <p id="statRebirthCount">0</p>
        </article>
      </section>

      <section class="panel settings">
        <h2>자동 옵션</h2>
        <label><input id="optAutoBattle" type="checkbox" /> 자동 전투</label>
        <label><input id="optAutoBreakthrough" type="checkbox" /> 자동 돌파</label>
        <label><input id="optAutoTribulation" type="checkbox" /> 자동 도겁 허용</label>
        <label><input id="optAutoResumeRealtime" type="checkbox" /> 앱 복귀 시 실시간 자동 재개</label>
        <div class="settings-grid">
          <label>
            전투 속도
            <select id="optBattleSpeed">
              <option value="1">저속</option>
              <option value="2">표준</option>
              <option value="3">고속</option>
            </select>
          </label>
          <label>
            오프라인 정산 시간(시간)
            <input id="optOfflineCapHours" type="number" min="1" max="168" step="1" />
          </label>
          <label>
            오프라인 세부 로그 개수
            <input id="optOfflineEventLimit" type="number" min="5" max="120" step="1" />
          </label>
        </div>
      </section>

      <section class="panel consumables">
        <h2>영약 / 부적</h2>
        <p>
          돌파 영약:
          <strong id="invBreakthroughElixir">0</strong>
          · 도겁 수호부:
          <strong id="invTribulationTalisman">0</strong>
        </p>
        <div class="consumable-toggles">
          <label><input id="useBreakthroughElixir" type="checkbox" checked /> 이번 돌파에 영약 사용</label>
          <label><input id="useTribulationTalisman" type="checkbox" checked /> 이번 돌파에 수호부 사용</label>
        </div>
        <p class="sub">
          돌파 성공률 <strong id="previewSuccessPct">-</strong>% · 도겁 사망률
          <strong id="previewDeathPct">-</strong>%
        </p>
        <p class="sub">
          실패 분기: 경상 <strong id="previewMinorFailPct">-</strong>% · 후퇴
          <strong id="previewRetreatFailPct">-</strong>%
        </p>
        <p class="sub">
          위험도 <strong id="previewRiskLabel" class="risk-pill">-</strong> · 실패 내 사망
          <strong id="previewDeathInFailPct">-</strong>%
        </p>
        <p class="sub mitigation-line">
          보정 효과 <strong id="previewMitigationLabel" class="risk-pill">-</strong>
          <span id="previewMitigationHint" class="recommendation-text">-</span>
        </p>
        <p class="sub recommendation-line">
          돌파 권장 <strong id="previewRecommendationLabel" class="risk-pill">-</strong>
          <span id="previewRecommendationHint" class="recommendation-text">-</span>
          <button id="btnApplyRecommendation" type="button" class="ghost-btn recommendation-btn">권장 설정 적용</button>
        </p>
      </section>

      <section class="panel actions">
        <h2>액션</h2>
        <div class="button-grid">
          <button id="btnBattle" type="button">전투 1회</button>
          <button id="btnBreakthrough" type="button">돌파 시도</button>
          <button id="btnAuto10s" type="button">자동 10초 진행</button>
          <button id="btnRealtimeAuto" type="button">실시간 자동 시작</button>
          <button id="btnResetRun" type="button">런 초기화</button>
        </div>
        <p class="sub">
          실시간 자동 상태:
          <strong id="realtimeAutoStatus">중지</strong>
        </p>
        <div class="realtime-grid">
          <article>
            <h3>누적 시간</h3>
            <p id="realtimeElapsed">0초</p>
          </article>
          <article>
            <h3>누적 전투</h3>
            <p id="realtimeBattles">0회</p>
          </article>
          <article>
            <h3>누적 돌파</h3>
            <p id="realtimeBreakthroughs">0회</p>
          </article>
          <article>
            <h3>누적 환생</h3>
            <p id="realtimeRebirths">0회</p>
          </article>
        </div>
        <div class="offline-detail-actions">
          <button id="btnExportRealtimeReport" type="button" class="ghost-btn">실시간 리포트 JSON</button>
          <button id="btnResetRealtimeStats" type="button" class="ghost-btn">실시간 통계 초기화</button>
        </div>
      </section>

      <section class="panel save">
        <h2>저장 / 복구</h2>
        <p class="sub">플레이어명</p>
        <input id="playerNameInput" type="text" maxlength="20" />
        <p class="sub">세이브 슬롯</p>
        <select id="optSaveSlot">
          <option value="1">슬롯 1</option>
          <option value="2">슬롯 2</option>
          <option value="3">슬롯 3</option>
        </select>
        <p class="sub">슬롯 복제 대상</p>
        <div class="slot-copy-row">
          <select id="optCopySlotTarget">
            <option value="1">슬롯 1</option>
            <option value="2">슬롯 2</option>
            <option value="3">슬롯 3</option>
          </select>
          <button id="btnCopySlot" type="button">활성 슬롯 복제</button>
        </div>
        <button id="btnToggleSlotLock" type="button" class="ghost-btn">활성 슬롯 잠금</button>
        <div id="slotActionHintBox" class="slot-action-hint-box">
          <p id="slotLockHint" class="sub slot-action-hint">잠금 상태 준비 중...</p>
          <p id="slotTargetHint" class="sub slot-action-hint">대상 슬롯 상태 준비 중...</p>
          <p id="slotCopyHint" class="sub slot-action-hint">복제 규칙 준비 중...</p>
          <p id="slotDeleteHint" class="sub slot-action-hint">삭제 규칙 준비 중...</p>
        </div>
        <p class="sub">
          마지막 저장:
          <strong id="lastSavedAt">없음</strong>
        </p>
        <p class="sub">
          마지막 활동:
          <strong id="lastActiveAt">없음</strong>
        </p>
        <div class="button-grid">
          <button id="btnSaveLocal" type="button">로컬 저장</button>
          <button id="btnLoadLocal" type="button">로컬 불러오기</button>
          <button id="btnExportState" type="button">JSON 내보내기</button>
          <button id="btnImportState" type="button">JSON 가져오기</button>
          <button id="btnDeleteSlot" type="button">활성 슬롯 삭제</button>
        </div>
        <p class="sub">슬롯 요약</p>
        <ul id="saveSlotSummaryList" class="slot-summary-list"></ul>
        <textarea
          id="savePayload"
          rows="8"
          placeholder="내보내기/가져오기 JSON"
        ></textarea>
      </section>

      <section class="panel assets">
        <h2>무료 에셋 바로가기</h2>
        <ul>
          <li><a href="https://kenney.nl/assets" target="_blank" rel="noreferrer">Kenney Asset Library (CC0)</a></li>
          <li><a href="https://opengameart.org/content/oriental-roof-tiles" target="_blank" rel="noreferrer">Oriental Roof Tiles (CC0)</a></li>
          <li><a href="https://opengameart.org/content/pixel-fx-pack" target="_blank" rel="noreferrer">Pixel FX Pack (CC0)</a></li>
        </ul>
      </section>

      <section class="panel logs">
        <h2>이벤트 로그</h2>
        <ul id="eventLogList"></ul>
      </section>
    </main>

    <aside id="offlineModal" class="offline-modal hidden" aria-hidden="true">
      <section
        class="offline-card"
        role="dialog"
        aria-modal="true"
        aria-labelledby="offlineModalTitle"
      >
        <header class="offline-card-head">
          <div>
            <p class="eyebrow">Offline Catch-up</p>
            <h2 id="offlineModalTitle">복귀 정산 결과</h2>
          </div>
          <button id="btnCloseOfflineModal" type="button" class="ghost-btn">닫기</button>
        </header>
        <p class="sub">
          적용 시간 <strong id="offlineAppliedDuration">0초</strong>
          · 원본 경과 <strong id="offlineRawDuration">0초</strong>
          · cap <strong id="offlineCapState">미적용</strong>
        </p>
        <div class="offline-grid">
          <article>
            <h3>전투</h3>
            <p id="offlineBattleCount">0회</p>
          </article>
          <article>
            <h3>돌파</h3>
            <p id="offlineBreakthroughCount">0회</p>
          </article>
          <article>
            <h3>환생</h3>
            <p id="offlineRebirthCount">0회</p>
          </article>
          <article>
            <h3>기 순변화</h3>
            <p id="offlineQiDelta">+0</p>
          </article>
          <article>
            <h3>영석 순변화</h3>
            <p id="offlineSpiritDelta">+0</p>
          </article>
          <article>
            <h3>환생정수 순변화</h3>
            <p id="offlineEssenceDelta">+0</p>
          </article>
        </div>
        <div class="offline-detail-actions">
          <button id="btnToggleOfflineDetail" type="button" class="ghost-btn">세부 로그 보기</button>
          <button id="btnExportOfflineReport" type="button" class="ghost-btn">정산 리포트 JSON</button>
        </div>
        <ul id="offlineDetailList" class="offline-detail-list hidden"></ul>
      </section>
    </aside>

    <script type="module" src="./app.mjs"></script>
  </body>
</html>
